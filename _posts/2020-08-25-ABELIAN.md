---
layout: post
title: "Abelian"
subtitle: "Abelian"
date: 2020-08-25 18:36:00
author: "Krystian Wojcicki"
header-img: "img/posts/jekyll-bg.jpg"
comments: true
tags: [Tutorial]
---

<script type="text/javascript" async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

<canvas id="myCanvas" width="700" height="700"></canvas>

<div id="model"></div>

<script>
setTimeout(function(){ 
  var width = 350;
  var height = 350;
  const colors = {
    0: "black",
    1: "red",
    2: "blue",
    3: "green"
  }

  var sand = new Array(height);

  for(var i = 0; i < height; i++){
    sand[i] = new Array(width);
    for(var j = 0; j < width; j++){
      sand[i][j] = 0;
    }
  }
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");

  ctx.fillStyle = "black";


  for(var i = 0; i <  height; i++){
    const newDiv = document.createElement("div"); 
    for(var j = 0; j < width; j++){
      ctx.fillRect(i * 2, j * 2, 2, 2);
    }
  }

  //console.log(height / 2, width / 2);
  const starting = 5000
  var i = 0;

  function run(){
    setInterval(function(){
      add_sand(height / 2, width / 2, starting);
      console.log("done step", i);
      i++;
      if(i % 10 == 0){
        draw();
      }
      run();
    }, 1000);
  }

  run();

  function draw(){
    for(var i = 0; i < height; i++){
      for(var j = 0; j < width; j++){
        const toColor = colors[sand[i][j]] || "yellow"
        ctx.fillStyle = toColor;
        ctx.fillRect(i * 2, j * 2, 2, 2);
      }
    }
  }

  function add_sand(x, y, inc){

    if(x < 0 || y < 0 || x >= height || y >= width) return

    sand[x][y] += inc

    while(sand[x][y] >= 4){
      //console.log(x, y, sand[x][y])
      sand[x][y] -= 4
      add_sand(x + 1, y, 1);
      add_sand(x - 1, y, 1);
      add_sand(x, y + 1, 1);
      add_sand(x, y - 1, 1);
    }
  }
}, 5000);
</script>
